components:
  schemas:
    CreateObjForIdInput:
      description: "Create object.\n\nfile_name (str): Name for the file being uploaded\n\
        aliases (list, optional): unique name to allow using in place of whatever\
        \ GUID gets\n    created for this upload\nmetadata (dict, optional): any additional\
        \ metadata to attach to the upload"
      properties:
        aliases:
          items: {}
          title: Aliases
          type: array
        file_name:
          title: File Name
          type: string
        metadata:
          title: Metadata
          type: object
      required:
      - file_name
      title: CreateObjForIdInput
      type: object
    CreateObjInput:
      description: "Create object.\n\nfile_name (str): Name for the file being uploaded\n\
        authz (dict): authorization block with requirements for what's being uploaded\n\
        aliases (list, optional): unique name to allow using in place of whatever\
        \ GUID gets\n    created for this upload\nmetadata (dict, optional): any additional\
        \ metadata to attach to the upload"
      properties:
        aliases:
          items: {}
          title: Aliases
          type: array
        authz:
          title: Authz
          type: object
        file_name:
          title: File Name
          type: string
        metadata:
          title: Metadata
          type: object
      required:
      - file_name
      - authz
      title: CreateObjInput
      type: object
    HTTPValidationError:
      properties:
        detail:
          items:
            $ref: '#/components/schemas/ValidationError'
          title: Detail
          type: array
      title: HTTPValidationError
      type: object
    ValidationError:
      properties:
        loc:
          items:
            type: string
          title: Location
          type: array
        msg:
          title: Message
          type: string
        type:
          title: Error Type
          type: string
      required:
      - loc
      - msg
      - type
      title: ValidationError
      type: object
  securitySchemes:
    HTTPBasic:
      scheme: basic
      type: http
    HTTPBearer:
      scheme: bearer
      type: http
info:
  title: Framework Services Object Management Service
  version: 1.3.0
openapi: 3.0.2
paths:
  /_status:
    get:
      operationId: get_status__status_get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Get Status
  /metadata:
    get:
      description: "Search the metadata.\n\nWithout filters, this will return all\
        \ data. Add filters as query strings like this:\n\n    GET /metadata?a=1&b=2\n\
        \nThis will match all records that have metadata containing all of:\n\n  \
        \  {\"a\": 1, \"b\": 2}\n\nThe values are always treated as strings for filtering.\
        \ Nesting is supported:\n\n    GET /metadata?a.b.c=3\n\nMatching records containing:\n\
        \n    {\"a\": {\"b\": {\"c\": 3}}}\n\nProviding the same key with more than\
        \ one value filters records whose value of the\ngiven key matches any of the\
        \ given values. But values of different keys must all\nmatch. For example:\n\
        \n    GET /metadata?a.b.c=3&a.b.c=33&a.b.d=4\n\nMatches these:\n\n    {\"\
        a\": {\"b\": {\"c\": 3, \"d\": 4}}}\n    {\"a\": {\"b\": {\"c\": 33, \"d\"\
        : 4}}}\n    {\"a\": {\"b\": {\"c\": \"3\", \"d\": 4, \"e\": 5}}}\n\nBut won't\
        \ match these:\n\n    {\"a\": {\"b\": {\"c\": 3}}}\n    {\"a\": {\"b\": {\"\
        c\": 3, \"d\": 5}}}\n    {\"a\": {\"b\": {\"d\": 5}}}\n    {\"a\": {\"b\"\
        : {\"c\": \"333\", \"d\": 4}}}"
      operationId: search_metadata_metadata_get
      parameters:
      - description: Switch to returning a list of GUIDs (false), or GUIDs mapping
          to their metadata (true).
        in: query
        name: data
        required: false
        schema:
          default: false
          description: Switch to returning a list of GUIDs (false), or GUIDs mapping
            to their metadata (true).
          title: Data
          type: boolean
      - description: 'Maximum number of records returned. (max: 2000)'
        in: query
        name: limit
        required: false
        schema:
          default: 10
          description: 'Maximum number of records returned. (max: 2000)'
          title: Limit
          type: integer
      - description: Return results at this given offset.
        in: query
        name: offset
        required: false
        schema:
          default: 0
          description: Return results at this given offset.
          title: Offset
          type: integer
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Search Metadata
      tags:
      - Query
    post:
      description: Create metadata in batch.
      operationId: batch_create_metadata_metadata_post
      parameters:
      - in: query
        name: overwrite
        required: false
        schema:
          default: true
          title: Overwrite
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              items: {}
              title: Data List
              type: array
        required: true
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Batch Create Metadata
      tags:
      - Maintain
  /metadata/{guid}:
    delete:
      description: Delete the metadata of the GUID.
      operationId: delete_metadata_metadata__guid__delete
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Delete Metadata
      tags:
      - Maintain
    get:
      description: Get the metadata of the GUID.
      operationId: get_metadata_metadata__guid__get
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Get Metadata
      tags:
      - Query
    post:
      description: Create metadata for the GUID.
      operationId: create_metadata_metadata__guid__post
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
      - in: query
        name: overwrite
        required: false
        schema:
          default: false
          title: Overwrite
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              title: Data
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Create Metadata
      tags:
      - Maintain
    put:
      description: 'Update the metadata of the GUID.


        If `merge` is True, then any top-level keys that are not in the new data will
        be

        kept, and those that also exist in the new data will be replaced completely.
        This

        is also known as the shallow merge. The metadata service currently doesn''t
        support

        deep merge.'
      operationId: update_metadata_metadata__guid__put
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
      - in: query
        name: merge
        required: false
        schema:
          default: false
          title: Merge
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              title: Data
              type: object
        required: true
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Update Metadata
      tags:
      - Maintain
  /metadata_index:
    get:
      description: List all the metadata key paths indexed in the database.
      operationId: list_metadata_indexes_metadata_index_get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: List Metadata Indexes
      tags:
      - Index
  /metadata_index/{path}:
    delete:
      description: Drop the database index on the given metadata key path.
      operationId: drop_metadata_indexes_metadata_index__path__delete
      parameters:
      - in: path
        name: path
        required: true
        schema:
          title: Path
      responses:
        '204':
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Drop Metadata Indexes
      tags:
      - Index
    post:
      description: Create a database index on the given metadata key path.
      operationId: create_metadata_indexes_metadata_index__path__post
      parameters:
      - in: path
        name: path
        required: true
        schema:
          title: Path
      responses:
        '201':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBasic: []
      - HTTPBearer: []
      summary: Create Metadata Indexes
      tags:
      - Index
  /objects:
    get:
      description: "Returns a list of objects and their corresponding Indexd records\
        \ (please\nsee URL query documentation for more info on which objects get\
        \ returned).\n\nThe filtering functionality was primarily driven by the requirement\
        \ that a\nuser be able to get all objects having an authz resource matching\
        \ a\nuser-supplied pattern at any index in the \"_resource_paths\" array.\n\
        \nFor example, given the following metadata objects:\n\n    {\n        \"\
        0\": {\n            \"message\": \"hello\",\n            \"_uploader_id\"\
        : \"100\",\n            \"_resource_paths\": [\n                \"/programs/a\"\
        ,\n                \"/programs/b\"\n            ],\n            \"pet\": \"\
        dog\",\n            \"pet_age\": 1\n        },\n        \"1\": {\n       \
        \     \"message\": \"greetings\",\n            \"_uploader_id\": \"101\",\n\
        \            \"_resource_paths\": [\n                \"/open\",\n        \
        \        \"/programs/c/projects/a\"\n            ],\n            \"pet\":\
        \ \"ferret\",\n            \"pet_age\": 5,\n            \"sport\": \"soccer\"\
        \n        },\n        \"2\": {\n            \"message\": \"morning\",\n  \
        \          \"_uploader_id\": \"102\",\n            \"_resource_paths\": [\n\
        \                \"/programs/d\",\n                \"/programs/e\"\n     \
        \       ],\n            \"counts\": [42, 42, 42],\n            \"pet\": \"\
        ferret\",\n            \"pet_age\": 10,\n            \"sport\": \"soccer\"\
        \n        },\n        \"3\": {\n            \"message\": \"evening\",\n  \
        \          \"_uploader_id\": \"103\",\n            \"_resource_paths\": [\n\
        \                \"/programs/f/projects/a\",\n                \"/admin\"\n\
        \            ],\n            \"counts\": [1, 3, 5],\n            \"pet\":\
        \ \"ferret\",\n            \"pet_age\": 15,\n            \"sport\": \"basketball\"\
        \n        }\n    }\n\nhow do we design a filtering interface that allows the\
        \ user to get all\nobjects having an authz string matching the pattern\n\"\
        /programs/%/projects/%\" at any index in its \"_resource_paths\" array? (%\n\
        has been used as the wildcard so far because that's what Postgres uses as\n\
        the wildcard for LIKE) In this case, the \"1\" and \"3\" objects should be\n\
        returned.\n\nThe filter syntax that was arrived at ending up following the\
        \ syntax\nspecified by a [Node JS implementation](https://www.npmjs.com/package/json-api#filtering)\
        \ of the [JSON:API\nspecification](https://jsonapi.org/).\n\nThe format for\
        \ this syntax is filter=(field_name,operator,value), in which\nthe field_name\
        \ is a json key without quotes, operator is one of :eq, :ne,\n:gt, :gte, :lt,\
        \ :lte, :like, :all, :any (see operators dict), and value is\na typed json\
        \ value against which the operator is run.\n\nExamples:\n\n    GET /objects?filter=(message,:eq,\"\
        morning\") returns \"2\"\n    GET /objects?filter=(counts.1,:eq,3) returns\
        \ \"3\"\n    GET /objects?filter=(pet_age,:lte,5) returns \"0\" and \"1\"\n\
        \    GET /objects?filter=(pet_age,:gt,5) returns \"2\" and \"3\"\n\nCompound\
        \ expressions are supported:\n\n    GET /objects?filter=(_resource_paths,:any,(,:like,\"\
        /programs/%/projects/%\")) returns \"1\" and \"3\"\n    GET /objects?filter=(counts,:all,(,:eq,42))\
        \ returns \"2\"\n\nBoolean expressions are also supported:\n\n    GET /objects?filter=(or,(_uploader_id,:eq,\"\
        101\"),(_uploader_id,:eq,\"102\")) returns \"1\" and \"2\"\n    GET /objects?filter=(or,(and,(pet,:eq,\"\
        ferret\"),(sport,:eq,\"soccer\")),(message,:eq,\"hello\")) returns \"0\",\
        \ \"1\", and \"2\""
      operationId: get_objects_objects_get
      parameters:
      - description: Switch to return a list of GUIDs (false), or metadata objects
          (true).
        in: query
        name: data
        required: false
        schema:
          default: true
          description: Switch to return a list of GUIDs (false), or metadata objects
            (true).
          title: Data
          type: boolean
      - description: The offset for what objects are returned (zero-indexed). The
          exact offset will be equal to page*limit (e.g. with page=1, limit=15, 15
          objects beginning at index 15 will be returned).
        in: query
        name: page
        required: false
        schema:
          default: 0
          description: The offset for what objects are returned (zero-indexed). The
            exact offset will be equal to page*limit (e.g. with page=1, limit=15,
            15 objects beginning at index 15 will be returned).
          title: Page
          type: integer
      - description: 'Maximum number of objects returned (max: 1024). Also used with
          page to determine page size.'
        in: query
        name: limit
        required: false
        schema:
          default: 10
          description: 'Maximum number of objects returned (max: 1024). Also used
            with page to determine page size.'
          title: Limit
          type: integer
      - description: The filter(s) that will be applied to the result (more detail
          in the docstring).
        in: query
        name: filter
        required: false
        schema:
          default: ''
          description: The filter(s) that will be applied to the result (more detail
            in the docstring).
          title: Filter
          type: string
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Get Objects
      tags:
      - Object
    post:
      description: "Create object placeholder and attach metadata, return Upload url\
        \ to the user.\n\nArgs:\n    body (CreateObjInput): input body for create\
        \ object\n    request (Request): starlette request (which contains reference\
        \ to FastAPI app)\n    token (HTTPAuthorizationCredentials, optional): bearer\
        \ token"
      operationId: create_object_objects_post
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateObjInput'
        required: true
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Create Object
      tags:
      - Object
  /objects/{guid}:
    delete:
      description: "Delete the metadata for the specified object. Remove the object\
        \ from\nexisting bucket location(s) by proxying to fence DELETE /data/file_id.\n\
        Uses the response status code from fence to determine whether user has\npermission\
        \ to delete metadata.\n\nArgs:\n    guid (str): indexd GUID or alias, or MDS\
        \ key\n    request (Request): starlette request (which contains reference\
        \ to FastAPI app)\nReturns:\n    204: if record and metadata are deleted\n\
        \    403: if fence returns a 403 unauthorized response\n    500: if fence\
        \ does not return 204 or 403 or there is an error deleting metadata"
      operationId: delete_object_objects__guid__delete
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Delete Object
      tags:
      - Object
    get:
      description: "Get the metadata associated with the provided key. If the key\
        \ is an\nindexd GUID or alias, also returns the indexd record.\n\nArgs:\n\
        \    guid (str): indexd GUID or alias, or MDS key\n    request (Request):\
        \ starlette request (which contains reference to FastAPI app)\n\nReturns:\n\
        \    200: { \"record\": { indexd record }, \"metadata\": { MDS metadata }\
        \ }\n    404: if the key is not in indexd and not in MDS"
      operationId: get_object_objects__guid__get
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Get Object
      tags:
      - Object
    post:
      description: "Create object placeholder and attach metadata, return Upload url\
        \ to the\nuser. A new GUID (new version of the provided GUID) will be created\
        \ for\nthis object. The new record will have the same authz as the original\
        \ one.\n\nArgs:\n    guid (str): indexd GUID or alias\n    body (CreateObjForIdInput):\
        \ input body for create object for ID\n    request (Request): starlette request\
        \ (which contains reference to FastAPI app)\n    token (HTTPAuthorizationCredentials,\
        \ optional): bearer token"
      operationId: create_object_for_id_objects__guid__post
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateObjForIdInput'
        required: true
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      security:
      - HTTPBearer: []
      summary: Create Object For Id
      tags:
      - Object
  /objects/{guid}/download:
    get:
      description: "Send a GET request to the data access service to generate a signed\
        \ download\nurl for the given GUID or alias. Returns the generated signed\
        \ download url\nto the user.\n\nArgs:\n    guid (str): indexd GUID or alias\n\
        \    request (Request): starlette request (which contains reference to FastAPI\
        \ app)\n\nReturns:\n    200: { \"url\": signed download url }\n    404: if\
        \ the data access service can not find GUID/alias in indexd\n    403: if the\
        \ data access service returns a 401 or a 403\n    500: if there is an error\
        \ making the request to the data access service\n    or the data access service\
        \ returns any other 400-range or 500-range\n    error"
      operationId: get_object_signed_download_url_objects__guid__download_get
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Get Object Signed Download Url
      tags:
      - Object
  /objects/{guid}/latest:
    get:
      description: "Attempt to fetch the latest version of the provided guid/key from\
        \ indexd.\nIf the provided guid/key is found in indexd, return the indexd\
        \ record and\nmetadata object associated with the latest guid fetched from\
        \ indexd. If the\nprovided guid/key is not found in indexd, return the metadata\
        \ object\nassociated with the provided guid/key.\n\nArgs:\n    guid (str):\
        \ indexd GUID or MDS key. alias is NOT supported because the\n        corresponding\
        \ endpoint in indexd does not accept alias\n    request (Request): starlette\
        \ request (which contains reference to FastAPI app)\n\nReturns:\n    200:\
        \ { \"record\": { indexd record }, \"metadata\": { MDS metadata } }\n    404:\
        \ if the key is not in indexd and not in MDS"
      operationId: get_object_latest_objects__guid__latest_get
      parameters:
      - in: path
        name: guid
        required: true
        schema:
          title: Guid
          type: string
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
        '422':
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HTTPValidationError'
          description: Validation Error
      summary: Get Object Latest
      tags:
      - Object
  /version:
    get:
      operationId: get_version_version_get
      responses:
        '200':
          content:
            application/json:
              schema: {}
          description: Successful Response
      summary: Get Version
